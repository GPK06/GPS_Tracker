{% extends "base.html" %}
{% block content %}
<div style="text-align: center;">
    <div class="card">
        <div class="card-header">üì° Live Tracker Active</div>
        
        <div style="font-size: 1.2rem; margin-bottom: 20px;">
            Status: <span id="status" style="font-weight:bold; color:orange">Initializing GPS...</span>
        </div>
        
        <div style="background:#eef; padding:15px; border-radius:5px; display:inline-block; text-align:left;">
            <strong>Instructions:</strong><br>
            1. Keep this tab open.<br>
            2. Do not let your screen sleep if possible.<br>
            3. Ensure Location Services are ON.
        </div>
    </div>
</div>

<script>
    function sendLocation(lat, lon) {
        fetch('/api/update_location', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ latitude: lat, longitude: lon })
        })
        .then(res => {
            if(res.ok) {
                const now = new Date().toLocaleTimeString();
                document.getElementById('status').innerHTML = 
                    `<span style='color:green'>‚óè Transmitting</span><br><br>Last Sent: ${now}<br>Lat: ${lat.toFixed(5)} | Lon: ${lon.toFixed(5)}`;
            } else {
                document.getElementById('status').innerText = "Server Error (Check Connection)";
                document.getElementById('status').style.color = "red";
            }
        })
        .catch(err => console.error(err));
    }

    if (navigator.geolocation) {
        navigator.geolocation.watchPosition(
            (pos) => sendLocation(pos.coords.latitude, pos.coords.longitude),
            (err) => {
                document.getElementById('status').innerText = "GPS Error: " + err.message;
                document.getElementById('status').style.color = "red";
            },
            { enableHighAccuracy: true, maximumAge: 0 }
        );
    } else {
        alert("Geolocation is not supported by this browser.");
    }
</script>
{% endblock %}
